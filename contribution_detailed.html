<!DOCTYPE html>
<html>
<head>
	<title>Catalog Agrogeophysic</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Bootstrap CSS File -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

	<!-- boostrap select -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>

	<!-- Favicons -->
	<link href="img/favicon.png" rel="icon">
	<link href="img/apple-touch-icon.png" rel="apple-touch-icon">

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,600,700,700i|Montserrat:300,400,500,600,700" rel="stylesheet">

	<!-- Libraries CSS Files -->
	<link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="lib/animate/animate.min.css" rel="stylesheet">
	<link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">
	<link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
	<link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

	<!-- Main Stylesheet File -->
	<!-- 	<link href="css/style.css" rel="stylesheet">  -->
 	<link href="css/style_contrib_details.css" rel="stylesheet">

	<!-- parsing .csv database -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="js/papaparse.min.js"></script>

</head>

<style type="text/css">

#imgfixed
{
    top:20px;
    background: blue;
    position: fixed;
    width: 25%;
}

</style>


<body>
	<header id="header_home">
		      <nav class="main-nav float-right d-none d-lg-block">
		        <ul>
		          <li class="active"><a href="catalog.html">Home</a></li>
		      </nav>
		    <div class="container">
		      <div class="logo float-left">
		        <!-- Uncomment below if you prefer to use an image logo -->
		        <h1 class="text-light"><a href="catalog.html" class="scrollto"><span>Catalog of agrogeophysical studies</span></a></h1>

						<!-- <a href="#header" class="scrollto"><img src="img/logo.png" alt="" class="img-fluid"></a> -->
		      </div>
		    </div>
		  </header>


  <section id="about">
    <div class="container">
      <div class="row">

        <div class="col-lg-5 col-md-6" >
           <div class="sticky-top">
          	<div class="about-img">
							<p>
								<img id="thumbnail" src="img/map/Eco_leaves_nature-512.png" width="40">
							<p>
						</div>
            <h1 id="contrib_title"></h1>
          </div>
       </div>

           <div class="col-lg-7 col-md-6">
              <div class="about-content">

								<h2 id="metrics">Metrics</h2>
	                <div id="altmetric" class="altmetric-embed" data-badge-type="donut" data-doi="">
									</div>

                <h2>Contribution overview</h2>
                  <ul class="list-group">
										<li id="contribution_type" class="list-group-item"><b>Type: </b></li>
										<li id="keywords" class="list-group-item"><b>Keywords: </b></li>
                    <li class="list-group-item"><a id="link" href="https://dx.doi.org/"  target="_blank"><b>Link to publication</b></a></li>
              		</ul>

               <h2>Prospection</h2>
               	<ul class="list-group">
									<li class="list-group-item" id="date"><b>Date: </b></li>
									<li class="list-group-item" id="latlong"><b>Lat/long: </b></li>
									<li class="list-group-item" id="method"><b>Method(s): </b></li>
									<li class="list-group-item" id="spatial_scale"><b>Spatial Scale: </b></li>
									<li class="list-group-item" id="temporal_scale"><b>Temporal Scale: </b></li>
                  <li class="list-group-item" id="instruments"><b>Instrument: </b></li>
	                <li class="list-group-item" id="dimensions"><b>Dimension: </b></li>
									<li class="list-group-item" id="permanent_setup"><b>Permanent setup: </b></li>
                </ul>

             <h2>Processing tools</h2>
               <ul class="list-group">
	               <li class="list-group-item" id="software_name"><b>Software: </b></li>
	               <li class="list-group-item" id="licence_type"><b>Licence type: </b></li>
	               <li class="list-group-item" id="DOI_proc_tools"><b>DOI: </b></li>
               </ul>

               <h2>Biotic</h2>
                 <ul class="list-group">
		               <li class="list-group-item" id="crop_type"><b>Species: </b></li>
		               <li class="list-group-item" id="organ"><b>Organ: </b></li>
                 </ul>

               <h2>Abiotic description</h2>
                 <ul class="list-group">
	               	<li class="list-group-item" id="soil_type"><b>Soil type: </b></li>
	                <li class="list-group-item" id="water_input"><b>Water input: </b></li>
               	 </ul>

               <h2>Contact description</h2>
               	 <ul class="list-group">
									 <li class="list-group-item" id="contrib_authors"><b>Contrib. Authors: </b></li>
                   <li class="list-group-item" id="surname_name"><b>1st. Author: </b></li>
									 <li class="list-group-item" id="email"><b>Email: </b></li>
                   <li class="list-group-item"><a id="author_contact" href=mailto:><b>Contact the author</b></a></li>
                </ul>


						<!-- notebook specific -->
						<h4><a id="mybinder" href="https://mybinder.org/v2/gh/agrogeophy/notebooks/master?filepath=notebooks/" class="btn btn-primary" target="_blank">Try model in binder </a></h4>

						<!-- dataset specific -->
						<ul id="dataset" class="list-group">
							<h4><a id="dataset_link" href="" class="btn btn-primary" target="_blank"> Link to data repo or code to reproduce dataset </a></h4>
							<h4><a id="reda_link" href="https://github.com/BenjMy/agrogeophy-data/raw/master/try-reda-master/" class="btn btn-primary" target="_blank">Download metadata journal file </a></h4>
						</ul>

						<p>
          		<h4>
          			<a href="mailto:benjamin.mary@unipd.it?subject=error%20dbb%20Agrogeophysic" class="btn btn-primary">Report an error </a>
          		</h4>
          	</p>

          </div>
        </div>
      </div>
    </div>

  </section>




<script type="text/javascript">

	// load csv database (it should already be cached from catalog.html)
	Papa.parse("db.csv", {
	  download: true,
	  header: true,
	  //worker: true, // for large csv
	  complete: function(res) {
	    console.log('database loaded:', res);
	    callback(res)
	    }
	  });

	function callback(res) {
		const db = res.data

		// get url parameters
		const queryString = window.location.search
		const urlParams = new URLSearchParams(queryString)
		const id = urlParams.get('id')
		let row = null
		for (let i = 0; i < db.length; i++) {
			if (db[i]['id'] == id) {
				row = db[i]
			}
		}
		if (row == null) {
			console.log('ERROR: id ' + id + ' has not been found in the database.')
		}
		console.log(row)

		function addInfo(id, val) {
			let a = document.getElementById(id)
			if (val != '' && typeof(val) != 'undefined') {
				a.innerHTML = a.innerHTML + val
			} else {
				a.remove()
			}
		}

		function addAttr(id, val, attr) {
			let a = document.getElementById(id)
			if (val != '' && typeof(val) != 'undefined') {
				a.setAttribute(attr, val)
			} else {
				a.remove()
			}
		}

		let thumbnail = "img/map/Eco_leaves_nature-512.png"
		if (row['thumbnail'] != '') {
			thumbnail = "img/map/" + row['thumbnail']
		}
		document.getElementById('thumbnail').href = thumbnail
		addInfo('contrib_title', row['Title'])

		// contribution overview
		addInfo('contribution_type', row['Contribution type'])
		addInfo('keywords', row['Keywords'])
		addAttr('link', 'https://dx.doi.org/' + row['DOI'], 'href')

		// contact description
		addInfo('contrib_authors', row['Authors'])
		if (row['Surname'] != '') {
			addInfo('surname_name', row['Surname'] + ' ' + row['Name'])
		} else {
			document.getElementById('surname_name').remove()
		}
		addInfo('email', row['Corresponding email'])
		if (row['Corresponding email'] != '') {
			addAttr('author_contact', 'mailto:' + row['Corresponding email'] + '?subject=CAGS%20contribution')
		} else {
			document.getElementById('author_contact').parentNode.remove()
		}



		if (row['Contribution type'] == 'Research article') {
			document.getElementById('altmetric').setAttribute('data-doi', row['DOI'])

			// prospection
			addInfo('date', row['Date'])
			if (row['Latitude'] != '') {
				addInfo('latlong', row['Latitude']/row['Longitude'])
			} else {
				document.getElementById('laglong').style.visibility = 'hidden'
			}
			addInfo('method', row['Method'])
			addInfo('spatial_scale', row['Spatial scale'])
			addInfo('temporal_scale', row['Temporal scale'])
			addInfo('instruments', row['Instruments'])
			addInfo('dimensions', row['Dimension'])
			addInfo('permanent_setup', row['Permanent setup'])

			// processing tools
			addInfo('software_name', row['Software name'])
			addInfo('licence_type', row['Software licence'])
			addInfo('DOI_proc_tools', row['DOI'])

			// biotic
			addInfo('crop_type', row['Crop type'])
			addInfo('organ', row['Organ studied'])

			// abiotic
			addInfo('soil_type', row['Soil type'])
			addInfo('water_input', row['Water input'])

			document.getElementById('mybinder').remove()
			document.getElementById('dataset').remove()

		} else if (row['Contribution type'] == 'Notebook') {
			let a = document.getElementById('mybinder')
			a.setAttribute('href', 'https://mybinder.org/v2/gh/agrogeophy/notebooks/master?filepath=notebooks/' + row['Notebook filename'])
			document.getElementById('dataset').remove()

		} else if (row['Contribution_type'] == 'Dataset') {
			addAttr('dataset_link', row['Dataset DOI'], 'href')
			document.getElementById('mybinder').remove()
		}


		// remove all empty list group and their above h6 title
		let uls = document.getElementsByClassName('list-group')
		for (let i = 0; i < uls.length; i++) {
			let children = uls[i].children
			let visible = false
			for (let j = 0; j < children.length; j++) {
				var visibility = uls[i].children[j].style.visibility
				if (visibility == '' || visibility == 'visible') {
					visible = true
				}
			}
			if (visible == false) {
				uls[i].previousSibling.previousSibling.remove() // remove h6 title
				uls[i].remove()

			}
		}

	}


</script>

<!-- # https://api.altmetric.com/embeds.html -->
<script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>

<footer>
Designed with <a href="https://bootstrapmade.com/">BootstrapMade</a>
</footer>

</body>
</html>
