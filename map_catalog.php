<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" >

<head>
  
<title>Catalog Agrogeophysic</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Geophysics, Roots, Water, Irrigation, Benjamin Mary, MSCA, Marie-Curie, Padova, Berkeley" name="keywords">
<meta content="GROWING MSCA project website" name="description">
<meta name="author" content="Benjamin Mary">


 <!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=TRACKING_ID"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-156846585-1');
</script>

  
<link href="css/form.css" rel="stylesheet">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<link rel="stylesheet" href="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css" />
<link rel="stylesheet" href="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css" />


<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/i18n/defaults-*.min.js"></script>

<!-- Favicons -->
<link href="img/favicon.png" rel="icon">
<link href="img/apple-touch-icon.png" rel="apple-touch-icon">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,600,700,700i|Montserrat:300,400,500,600,700" rel="stylesheet">

<!-- Bootstrap CSS File -->
<link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

 <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<!--
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
 -->
 
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

<!-- Libraries CSS Files -->
<link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="lib/animate/animate.min.css" rel="stylesheet">
<link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">
<link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
<link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

<link href="css/addons/datatables.min.css" rel="stylesheet">


<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/js/dataTables.bootstrap4.min.js"></script>
<link href="https://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>


<script type="text/javascript" src="js/addons/datatables.min.js"></script>

<!--  <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">

<!-- Main Stylesheet File -->
<link href="css/style.css" rel="stylesheet">

<style>
  html, body {
     height: 100%;
     margin: 0;
  }
/*  #map-container {
      margin-left: auto;
      margin-right: auto;
      width: 60%;
  }*/

/* About section
--------------------------------*/
input[type=text] {
  width: 60%;
  padding: 0px 20px;
  margin: 0px 0;
  box-sizing: border-box;
  border: none;
  border-bottom: 1px solid blue;
  transition: width 0.4s ease-in-out;
}

/*input[type=text]:focus {
  width: 100%;
}*/

#about_catalog {
  padding: 60px 0;
  overflow: hidden;
}

#about_catalog #about_catalog-list {
  padding: 0;
  list-style: none;
}

#about_catalog #about_catalog-list li {
  border-bottom: 1px solid #ebebeb;
}

#about_catalog #about_catalog-list a {
  padding: 22px 0;
  display: block;
  position: relative;
  font-family: "Montserrat", sans-serif;
  font-size: 20px;
  line-height: 1;
  font-weight: 400;
  padding-right: 20px;
}

#about_catalog #about_catalog-list i {
  font-size: 24px;
  position: absolute;
  right: 0;
  top: 20px;
}

#about_catalog #about_catalog-list p {
  margin-bottom: 20px;
}

#about_catalog #about_catalog-list a.collapse {
  color: #1bb1dc;
}

#about_catalog #about_catalog-list a.collapsed {
  color: #000;
}

#about_catalog #about_catalog-list a.collapsed i::before {
  content: "\f2c7" !important;
}

/* count_db section
--------------------------------*/

#count_db .counters {
  padding-top: 40px;
}

#count_db .counters span {
  font-family: "Montserrat", sans-serif;
  font-weight: bold;
  font-size: 48px;
  display: block;
  color: #555186;
}

#count_db .counters p {
  padding: 0;
  margin: 0 0 20px 0;
  font-family: "Montserrat", sans-serif;
  font-size: 14px;
  color: #8a87b6;
}
/* gridmysql_results Section
--------------------------------*/

#gridmysql_results {
  padding: 0px 0 0px 0;
}

#gridmysql_results .box {
  padding: 30px;
  position: relative;
  overflow: hidden;
  border-radius: 2px;
  margin: 0 10px 40px 10px;
  background: #fff;
  box-shadow: 0 10px 29px 0 rgba(68, 88, 144, 0.1);
  transition: all 0.3s ease-in-out;
  text-align: center;
}


#gridmysql_results .box:hover {
  -webkit-transform: scale(1.1);
  transform: scale(1.1);
}

#gridmysql_results .icon {
  margin: 0 auto 15px auto;
  padding-top: 12px;
  display: inline-block;
  text-align: center;
  border-radius: 50%;
  width: 60px;
  height: 60px;
}

#gridmysql_results .icon i {
  font-size: 36px;
  line-height: 1;
}

#gridmysql_results .title {
  font-weight: 700;
  margin-bottom: 15px;
  font-size: 18px;
}

#gridmysql_results .title a {
  color: #111;
}

#gridmysql_results .box:hover .title a {
  color: #1bb1dc;
}

#gridmysql_results .description {
  font-size: 14px;
  line-height: 28px;
  margin-bottom: 0;
  text-align: left;
}


/* objectives Section
--------------------------------*/

#objectives {
  padding: 80px 0;
}

#objectives .about-content {
  padding-top: 40px;
}

#objectives .about-content h2 {
  color: #413e66;
  font-family: "Montserrat", sans-serif;
  font-weight: 700;
}

#objectives .about-content h3 {
  color: #696592;
  font-weight: 400;
  font-size: 22px;
  font-style: italic;
}

#objectives .about-content ul {
  list-style: none;
  padding: 0;
}

#objectives .about-content ul li {
  padding-bottom: 10px;
}

#objectives .about-content ul li i {
  font-size: 20px;
  padding-right: 4px;
  color: #1bb1dc;
}

#objectives .about-img {
  position: relative;
  margin: 30px 30px 30px 30px;
}

#objectives .about-img img {
  width: 80%;
  border: 0px solid #fff;
  transition: .5s;
}

#objectives .about-img img:hover {
  width: 100%;
  -webkit-transform: scale(1.03);
  transform: scale(1.03);
}

#objectives .about-img::before {
  position: absolute;
  left: -31px;
  top: -30px;
  width: 80%;
/*  height: 92%;*/
  z-index: -1;
  content: '';
  background-color: white;
  transition: .5s;
}

#objectives .about-img::after {
  position: absolute;
  right: -31px;
  bottom: -30px;
  width: 90%;
  height: 92%;
  z-index: -1;
  content: '';
  background-color: white;
  transition: .5s;
}

#objectives .msca-logo {
    width: 50%;
    height: auto;
}

/*---- Useful links section
*/
#useful_links {
  padding: 80px 0;
}

#useful_links .about-content {
  padding-top: 40px;
}

#useful_links .about-content h2 {
  color: #413e66;
  font-family: "Montserrat", sans-serif;
  font-weight: 700;
}

#useful_links .about-content h3 {
  color: #696592;
  font-weight: 400;
  font-size: 22px;
  font-style: italic;
}

#useful_links .about-content ul {
  list-style: none;
  padding: 0;
}

#useful_links .about-content ul li {
  padding-bottom: 10px;
}

#useful_links .about-content ul li i {
  font-size: 20px;
  padding-right: 4px;
  color: #1bb1dc;
}

#useful_links .about-img {
  position: relative;
  margin: 30px 30px 30px 30px;
}

#useful_links .about-img img {
  width: 80%;
  border: 0px solid #fff;
  transition: .5s;
}

#useful_links .about-img img:hover {
  width: 100%;
  -webkit-transform: scale(1.03);
  transform: scale(1.03);
}

#useful_links .about-img::before {
  position: absolute;
  left: -31px;
  top: -30px;
  width: 80%;
/*  height: 92%;*/
  z-index: -1;
  content: '';
  background-color: white;
  transition: .5s;
}

#useful_links .about-img::after {
  position: absolute;
  right: -31px;
  bottom: -30px;
  width: 90%;
  height: 92%;
  z-index: -1;
  content: '';
  background-color: white;
  transition: .5s;
}

#useful_links .msca-logo {
    width: 50%;
    height: auto;}

#map{
    margin-top: 100px;
}

}

</style>
</head>

<body>


<!-- header home-->
<!---------------->

<?php include("header_home.php"); ?>

 <!-- leaflet map-->
 <!---------------->
<section id="studyAreas">
    <div class="container">

      <!-- <section id="" class="section-bg">
 --><!--       <div class="container">
  -->            


  <div id="map">map</div>
<!--              style="width: 850px; height: 400px;
 -->  
  *The map only display georeferenced studies. 
  
    </div>
<!-- </section>
 -->

<!--   <header class="section-header">
  <h3>Results</h3>
  </header> -->


<?php
// -------------//
// CONNECT TO DB
// -------------//
include("dbb/connect_db.php");


// -------------//
// Count nb of entries 
// -------------//
// $conn = new PDO('mysql:host=localhost;dbname=agrigeophy');
// $conn = new PDO('mysql:host=localhost;dbname=agrigeophy;charset=utf8', 'root', '');

//The COUNT SQL statement that we will use.
$sql = "SELECT COUNT(*) AS num FROM main";
//Prepare the COUNT SQL statement.
$stmt = $conn->prepare($sql);
//Execute the COUNT statement.
$stmt->execute();
//Fetch the row that MySQL returned.
$rownb = $stmt->fetch(PDO::FETCH_ASSOC);
//The $row array will contain "num". Print it out.

$sql = "SELECT COUNT(organisation) AS num_org FROM contact";
$stmt = $conn->prepare($sql);
$stmt->execute();
$rownb_org = $stmt->fetch(PDO::FETCH_ASSOC);
//The $row array will contain "num". Print it out.

$sql = "SELECT COUNT(contrib_type) AS num_models FROM main where contrib_type = 'Notebook'";
$stmt = $conn->prepare($sql);
$stmt->execute();
$rownb_models = $stmt->fetch(PDO::FETCH_ASSOC);

$sql = "SELECT COUNT(contrib_type) AS num_dataset FROM main where contrib_type = 'Dataset'";
$stmt = $conn->prepare($sql);
$stmt->execute();
$rownb_datasets = $stmt->fetch(PDO::FETCH_ASSOC);

?>

<section id="count_db" class="wow fadeIn">

  <div class="container">
        <div class="row counters">

        <div class="col-lg-3 col-6 text-center">
          <span data-toggle="counter-up"><?php echo $numOfCols = $rownb['num'];?></span>
          <p>Nb of contributions</p>
        </div>
        <div class="col-lg-3 col-6 text-center">
          <span data-toggle="counter-up"><?php echo $numOfCols = $rownb_org['num_org'];?></span>
          <p>Nb of organisations</p>
        </div>
        <div class="col-lg-3 col-6 text-center">
          <span data-toggle="counter-up"><?php echo $numOfCols = $rownb_models['num_models'];?></span>
          <p>Nb of notebook models</p>
        </div>
        <div class="col-lg-3 col-6 text-center">
          <span data-toggle="counter-up"><?php echo $numOfCols = $rownb_datasets['num_dataset'];?></span>
          <p>Nb of datasets</p>
        </div>
        </div>
  </div>

  <section>

  <div class="container">


  <?php  include('table_geophy.php'); 
  ?>
  Extend and select the collumns thanks to the widget on the top right corner of the table. Export it using the second widget.
  *The current table is mainly build on top of the review article from Zhao et al. 2019. 

        </div>

  </section>



<!-- --------------------------------------------------
------------- OBJECTIVES -------------------------
-------------------------------------------------- -->
<section id="objectives">
<header class="section-header">
  <h3>Objectives</h3>
<!--           <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque</p>
-->        </header>

    <div class="container">
<!--         <div class="row">
 -->            <div class="about-content">
  
<!--             <div class="col-lg-5 col-md-6">
 -->            <h3>
                  <ul class="columns" data-columns="2">
                    <li><i class="ion-android-checkmark-circle"></i> Build a repository that is trust by the community </li> 
                 <li><i class="ion-android-checkmark-circle"></i>  Gather datasets needed for modeling </li>
<!--                   <li><i class="ion-android-checkmark-circle"></i> Create synergies </li>               
 -->                    <li><i class="ion-android-checkmark-circle"></i>  Finding easily georeferenced data-sets linked to research themes </li>
                    <li><i class="ion-android-checkmark-circle"></i> Facilitate communication to stakeholders </li>
                  </ul>
                </h3>
<!--             </div>
 -->          </div>
      </div>


</section>


<!-- --------------------------------------------------
------------- Data mining  -------------------------
-------------------------------------------------- -->

<section id="DataMining">
<header class="section-header">
  <h3>Data mining</h3>
</header>
  <div class="container">
    <div class="text-center">
      <img src="./img/map/wordcloud.png" alt="Keywords cloud" class="rounded" width="1000">
    </div>
  </div>
</section>


<!-- --------------------------------------------------
------------- CONTRIBUTE  -------------------------
-------------------------------------------------- -->

 <section id="about_catalog">
      <div class="container">
        <header class="section-header">
          <h3 id="howtocontribute">How to contribute</h3>
<!--           <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque</p>
 -->        </header>

        <ul id="about_catalog-list" class="wow fadeInUp">
          <li>
            <a data-toggle="collapse" class="collapsed" href="#sub_00" id="subm_comm">Submit a scientific communication<i class="ion-android-remove"></i></a>
            <div id="sub_00" class="collapse" data-parent="#about_catalog-list">
              <a href="input_form" target="_blank"> Fill the form here </a>
           </div>
          </li>
          <li>
            <a data-toggle="collapse" class="collapsed" href="#sub_0" id="subm_model">Submit a notebook<i class="ion-android-remove"></i></a>
            <div id="sub_0" class="collapse" data-parent="#about_catalog-list">
              <p>

              Before submiting take a look for exemples at the jupyter notebook repository here: <a href="https://github.com/BenjMy/agrogeophy-notebooks.git"> Github agrogeophy-notebooks repo</a>

              Then fill the form: <a href="input_form_notebook" target="_blank"> submit notebook </a>

<!--         Here:  find an exemple Jupyter notebook template demonstrating how the process of experimental data
 -->        <?php
        // include('./dbb/M_models/agrogeophy-notebooks/html/blanchy_wheat-rwu-ert-timelapse.html');
        ?>
            </p>
            </div>
          </li>
          <li>
          <li>
            <a data-toggle="collapse" class="collapsed" href="#sub_1" id="subm_dataset">Submit a dataset<i class="ion-android-remove"></i></a>
            <div id="sub_1" class="collapse" data-parent="#about_catalog-list">
        <?php
        echo '<p> under construction - coming soon! </p>'

        // 1 - execute the binder with your dataset
        // 2 - fill the form

        ?>
        <ol>
          <li>import the data with REDA notebook</li>
          <li>fill the form</li>
        </ol>
        <p>
          We are building here a routine to import any kind of geoelectrical (ERT/SIP) input formats  datasets via REDA python package and to be returned into the database. The routine should help to fill with metadata the field of the "acquisition" table of the database + a journal file would be avaiable for download containing all instrumental information, import and pre-processing about the dataset (see REDA manual for more details).
        </p>
        <p>
          The dataset would not be stored within the website but in dedicated repositories: 
        Exemple of repositories: zenodo
        </p>
        <p>
        Exemple of EIT dataset: https://zenodo.org/record/1320755
         (provided by M. Weigand) supporting the paper "Imaging and functional characterization of crop root systems using spectroscopic electrical impedance measurements: <a href=https://doi.org/10.1007/s11104-018-3867-3 target="_blank">here</a><?php
        // include('.\dbb\M_models\jupyter_notebooks\lorenz.html');
        ?>
                </p>
                              <p>
        To upload a dataset-metadata journal rendez-vous: <a href="https://github.com/BenjMy/agrogeophy-data.git"> Github agrogeophy-data repo</a>
        You can find there Jupyter notebook template demonstrating how to import a dataset using REDA. 
            </p>
            </div>
          </li>
          <li>
            <a data-toggle="collapse" class="collapsed" href="#sub_2" id="subm_bench">Challenge the community!<i class="ion-android-remove"></i></a>
            <div id="sub_2" class="collapse" data-parent="#about_catalog-list">
              <p>
        <!-- - Submit a dataset for benchmarking of inversion process -->
        Coming soon
        </p>
            </div>
          </li>
        </ul>

      </div>

    </section><!-- #about_catalog -->

<!-- --------------------------------------------------
------------- about_catalog  -------------------------
-------------------------------------------------- -->
 <section id="about_catalog">
      <div class="container">
        <header class="section-header">
          <h3>About the catalog</h3>
<!--           <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque</p>
 -->        </header>

        <ul id="about_catalog-list" class="wow fadeInUp">
          <li>
            <a data-toggle="collapse" class="collapsed" href="#faq0">Database architecture<i class="ion-android-remove"></i></a>
            <div id="faq0" class="collapse" data-parent="#about_catalog-list">
              <p>
               <div class="caption"><h3><img src="img/db_structure.png" width="800"></h3></div>
              </p>
            </div>
          </li>
          <li>
          <li>
            <a data-toggle="collapse" class="collapsed" href="#faq1">Cite us<i class="ion-android-remove"></i></a>
            <div id="faq1" class="collapse" data-parent="#about_catalog-list">
              <p>
               DOI VZJ paper 
              </p>
            </div>
          </li>
          <li>
            <a data-toggle="collapse" class="collapsed" href="#faq2">Term of use<i class="ion-android-remove"></i></a>
            <div id="faq2" class="collapse" data-parent="#about_catalog-list">
              <p>
               The agrigeophysical catalog is made available under the Open Data Commons Attribution License (ODC-By) v1.0. [https://opendatacommons.org/licenses/by/1.0/]
              </p>
            </div>
          </li>
          <li>
            <a data-toggle="collapse" class="collapsed" href="#faq3">Credits<i class="ion-android-remove"></i></a>
            <div id="faq3" class="collapse" data-parent="#about_catalog-list">
              <p>
              Website inspired from the wonderfull work of quantitative-plant (https://www.quantitative-plant.org/ ).  </br>
              Created and maintained in the framework of the Growing project by B. Mary.              
             </p>
            </div>
          </li>
        </ul>

      </div>

    </section><!-- #about_catalog -->




<!-- --------------------------------------------------
------------- USEFUL LINKS  -------------------------
-------------------------------------------------- -->
<section id="useful_links">
<header class="section-header">
  <h3>Useful links</h3>
<!--           <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque</p>
--> 
</header>

    <div class="container">
<!--         <div class="row">
 -->            <div class="about-content">
  
<!--             <div class="col-lg-5 col-md-6">
 -->            <h3>
                  <ul class="columns" data-columns="2">
                    <li><i class="ion-android-checkmark-circle"></i>Wikipedia page: <a href="https://en.wikipedia.org/wiki/Comparison_of_free_geophysics_software">Comparison of free geophysics software:</a></li> 
                 <li><i class="ion-android-checkmark-circle"></i>  A website presenting image analysis software tools and models for plants: <a href="https://www.quantitative-plant.org/">https://www.quantitative-plant.org/</a>  </li>
<!--                   <li><i class="ion-android-checkmark-circle"></i> Create synergies </li>               
 -->                    <li><i class="ion-android-checkmark-circle"></i>  ISMC - The International Soil Modeling:
                <a href="https://soil-modeling.org/">ISMC data</a> 

 </li>
                  </ul>
                </h3>
<!--             </div>
 -->          </div>
      </div>

</section>



<footer id="all-to-action" class="section-bg">
  <div class="footer-top">
    <div class="container">
          <h4><a href="mailto:CatalogAgroGeophy-admin@gmail.com?subject=Catalog AgroGeophy"> Email support </a></h4>
        <!--
          All the links in the footer should remain intact.
          You can delete the links only if you purchased the pro version.
          Licensing information: https://bootstrapmade.com/license/
          Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/buy/?theme=Rapid
        -->
          <div class="copyright">
            <p>
              This project has received funding from the European Union's Horizon 2020 research and innovation programme under the Marie Sklodowska-Curie grant agreement No 842922.
            </p>
          </div>
          <div class="copyright">
            &copy; Copyright <strong>Rapid</strong>. All Rights Reserved
          </div>
          <div class="credits">
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
          </div>

    </div>

<!--   <h6> Designed with <a href="https://bootstrapmade.com/">BootstrapMade</a> </h6> 
 -->
</footer>
<?php
    // ------------------------------------------------------------------------------------
    //Making database connection

    try
    {
    }
    catch(Exception $e)
    {
            die('Erreur : '.$e->getMessage());
    }

    include("dbb/join_query.php"); # return sql_main_joint
    // echo $sql_main_joint;

    // new without joint
    $select = $conn->prepare($sql_main_joint);
    $select->execute();


?>


<?php

########################################
# Build GeoJSON feature collection array 
########################################

$geojson = array(
   'type'      => 'FeatureCollection',
   'features'  => array()
);

?>

    <?php
    # Loop through rows to build feature arrays
    while ($row = $select->fetch(PDO::FETCH_ASSOC)) {

        $properties = $row;
        // echo var_dump($properties);
        unset($properties['icon_img']);
        unset($properties['software_name']);
        unset($properties['licence_type']);
        unset($properties['DOI_proc_tools']);
        unset($properties['id_contact_l2']);
        // unset($properties['name']);
        // unset($properties['surname']);
        // unset($properties['organisation']);
        unset($properties['email']);
        unset($properties['website']);
        unset($properties['contrib_title']);

        echo "<br>";
        // echo "remove icon";


        // echo var_dump($properties);
        // echo var_dump($row['y']);
        if($row['y']== NULL)
        {
            // echo 'null';
        }
        else
        {
        // unset($properties['y']);
        $feature = array(
            'type' => 'Feature',
            'geometry' => array(
                'type' => 'Point',
                'coordinates' => array(
                  (float) $row['y'], 
                  (float) $row['x']
                )
            ),
            'properties' => $properties
        );
        // echo 'Add feature arrays to feature collection array';

        # Add feature arrays to feature collection array
        array_push($geojson['features'], $feature);

    // echo  var_dump((float) $row['x']);
    // echo  var_dump((float) $row['y']);
            } // end cond coordinates



    } // end while loop

    $select->closeCursor(); // Termine le traitement de la requête

    // header('Content-type: application/json');
    // echo json_encode($geojson, JSON_NUMERIC_CHECK);
    $fp = fopen('./dbb/map.json', 'w');
    fwrite($fp, json_encode($geojson, JSON_NUMERIC_CHECK));
    fclose($fp);

?>



<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<!-- <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
 -->
 <script src="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"></script>
<script>
  var map;

  var mapquestOSM = new L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                  '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                  'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox/light-v9'
              });

  var mapquestOAM = new L.TileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg", {
    maxZoom: 17,
    subdomains: ["oatile1", "oatile2", "oatile3", "oatile4"],
    attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'
  });




  // Bike Racks
  var AgrogeophyIcon = L.icon({
    iconUrl: 'img/map/Eco_leaves_nature-512.png',
    iconSize: [24, 28],
    iconAnchor: [12, 28],
    popupAnchor: [0, -25]
  });
    agrogeophy = new L.geoJson(null, {
      pointToLayer: function (feature, latlng) {
        return L.marker(latlng, {
          icon: AgrogeophyIcon,
          title: feature.properties.organisation
        });
      },
      onEachFeature: function (feature, layer) {
        if (feature.properties) {
          var myJSON = JSON.stringify(feature.properties.id);
          // document.write(myJSON)

          var content = '<table border="0" style="border-collapse:collapse;" cellpadding="2">' +
            '<tr>' + '<th>Org.:</th>' + '<td>' + feature.properties.organisation + '</td>' + '</tr>' +
            '<tr>' + '<th>Methods:</th>' + '<td>' +  feature.properties.method +   '</td>' + '</tr>' +
            '<tr>' + '<th></th>' + '<td>'+ '<a href="contribution_detailed.php?idnb=' + JSON.stringify(feature.properties.id) + '"> More</a>'  + 
            '</td>' + '</tr>' +
             // '<tr>' + '<th>Date:</th>' + '<td>' + feature.properties.datep + '</td>' + '</tr>' +
           // '<tr>' + '<th></th>' + '<td>' +"'<a href='"feature.properties.DOI">"</a>'+  '</td>' + '</tr>' +
            '<table>';
          layer.bindPopup(content);
        }
      }
    });

  agrogeophyClusters = new L.MarkerClusterGroup({
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true,
    disableClusteringAtZoom: 16
  });
  $.getJSON("./dbb/map.json", function (data) {
    agrogeophy.addData(data);
    agrogeophyClusters.addLayer(agrogeophy);
  }).complete(function () {
    map.fitBounds(agrogeophy.getBounds());
  });

  map = new L.Map("map",{
    layers: [mapquestOSM, agrogeophyClusters]
  });

  var baseLayers = {
   "MapQuest Aerial": mapquestOAM
  };
  var overlays = {
   "Agrogeophysical sites (clustered)": agrogeophyClusters
   // "Bus Routes": busRoutes
  };

  layersControl = new L.Control.Layers(baseLayers, overlays, {
   collapsed: false
  });

  map.addControl(layersControl);



</script>



  <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>
  <!-- Uncomment below i you want to use a preloader -->
  <!-- <div id="preloader"></div> -->

  <!--==========================
  -- JavaScript Libraries 
  ============================-->

<!-- form
 -->

  <!-- JavaScript Libraries -->
  <script src="lib/jquery/jquery.min.js"></script>
  <script src="lib/jquery/jquery-migrate.min.js"></script>
  <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/mobile-nav/mobile-nav.js"></script>
  <script src="lib/wow/wow.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/counterup/counterup.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="lib/isotope/isotope.pkgd.min.js"></script>
  <script src="lib/lightbox/js/lightbox.min.js"></script>
  <!-- Contact Form JavaScript File -->
  <script src="contactform/contactform.js"></script>

  <!-- Template Main Javascript File -->
  <script src="js/main.js"></script>

</body>
</html>